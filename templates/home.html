{% extends "base.html" %}
{% block title %}Home{% endblock %}

{% block content %}
<div class="filters">
    <form action="{{ url_for('home') }}" method="GET" class="filter-form">
        <input type="text" name="q" placeholder="Search products..." value="{{ search_query }}">

        <select name="category">
            <option value="">All Categories</option>
            {% for category in categories %}
            <option value="{{ category.Category_ID }}" {% if category_id|int == category.Category_ID %}selected{% endif %}>{{ category.Name }}</option>
            {% endfor %}
        </select>

        <input type="number" name="min_price" placeholder="Min Price" value="{{ min_price }}">
        <input type="number" name="max_price" placeholder="Max Price" value="{{ max_price }}">

        <button type="submit">Filter</button>
    </form>
</div>

{% if products %}
<div class="product-grid">
    {% for product in products %}
    <div class="product-card">
        <img src="{{ url_for('static', filename='images/' ~ (product.Image_URL if product.Image_URL else 'placeholder.png')) }}" 
        alt="{{ product.Name }}" class="product-image">

        <h3>{{ product.Name }}</h3>
        <p class="price">â‚¹{{ product.Price }}</p>
        {% if product.Stock_Quantity > 0 %}
            <span class="badge in-stock">In Stock</span>
        {% else %}
            <span class="badge out-of-stock">Out of Stock</span>
        {% endif %}
        <a href="{{ url_for('product_details', product_id=product.Product_ID) }}" class="btn">View Details</a>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
<div class="pagination">
    {% if page > 1 %}
    <a href="{{ url_for('home', q=search_query, category=category_id, min_price=min_price, max_price=max_price, page=page-1) }}">&laquo; Prev</a>
    {% endif %}
    {% for p in range(1, total_pages+1) %}
        {% if p == page %}
            <span class="current">{{ p }}</span>
        {% else %}
            <a href="{{ url_for('home', q=search_query, category=category_id, min_price=min_price, max_price=max_price, page=p) }}">{{ p }}</a>
        {% endif %}
    {% endfor %}
    {% if page < total_pages %}
    <a href="{{ url_for('home', q=search_query, category=category_id, min_price=min_price, max_price=max_price, page=page+1) }}">Next &raquo;</a>
    {% endif %}
</div>

{% else %}
<p>No products found for "<strong>{{ search_query }}</strong>"</p>
{% endif %}
{% endblock %}